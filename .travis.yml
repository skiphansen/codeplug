language: python

python:
  - 3.5
  - 3.6
  - 3.7-dev

install:
  - pip install .

script:
  - |
      cat <<EOF >codeplug.cfg
      [codeplug]
      key = $(head -c32 /dev/urandom | base64 -w0)
      iv = $(head -c16 /dev/urandom | base64 -w0)
      signing_key = $(openssl genrsa 1024 | sed 's/^/    /')
      EOF
  - |
      cat <<EOF >test.xml
      <LTD_CODEPLUG VERSION="10.05.06">
        <CS_PARTITION>
          <CS_INFO_TYPE_GRP>
            <CS_INFO_TYPE Applicable="Enabled" ListID="0">
              <CS_FWID Applicable="Enabled" ListID="0">0C78E1B906C54D3A8F264CE5C4F0B9DF</CS_FWID>
            </CS_INFO_TYPE>
          </CS_INFO_TYPE_GRP>
        </CS_PARTITION>
      </LTD_CODEPLUG>
      EOF
  - python codeplug.py build test.xml
  - python codeplug.py decode test.xml.ctb
  - diff -u test.xml test.xml.ctb.xml
